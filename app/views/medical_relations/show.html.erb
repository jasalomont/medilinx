<div class="page-header">
  <h3>Expediente de Paciente: <%= @medical_relation.patient.first_name %> <%= @medical_relation.patient.last_father %> <%= @medical_relation.patient.last_mother %></h3>
</div>

<div class="row">
  <div class="col-md-12 mb-2">
    <dl class="dl-horizontal">

      <dt>Paciente</dt>
      <dd><%= @medical_relation.patient.first_name %> <%= @medical_relation.patient.last_father %> <%= @medical_relation.patient.last_mother %></dd>
      <dt>Edad</dt>
      <dd><%= @age %></dd>
      <dt>Sexo</dt>
      <dd> <%=@gender %></dd>
      <dt>Telefono</dt>
      <dd><%= @medical_relation.patient.phone_mobile %></dd>

    </dl>

    <!-- Boton Crear nota medica  -->
    <div >
      <form action="/create_event" method="post">
        <!-- Hidden input for authenticity token to protect from forgery -->
        <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

        <!-- Label and input for patient_id -->
        <div class="form-group">
          <input type="hidden" id="patient_id" name="patient_id" placeholder="patient_id" class="form-control" value="<%= @medical_relation.patient_id %>">
        </div>
        <!-- Label and input for doctor_id -->
        <div class="form-group">
          <input type="hidden" id="doctor_id" name="doctor_id" placeholder="Doctor" class="form-control" value="<%= current_doctor.id %>">
        </div>

        <h3>
          <button class="btn btn-md btn-primary">
            Nuevo Record
          </button>
        </h3>
      </form>


    </div>

    <div class="row">
      <div class="col-md-12">
        <table class="table table-striped table-hover">
          <tr>
            <th>Fecha</th>
            <th>Tipo de nota</th>
            <th>Diagnostico</th>
            <th>Tratamiento</th>
            <th>Acci√≥n</th>
            <th>Status Reclamo</th>

          </tr>

          <% @events.where("patient_id" => @medical_relation.patient_id).each do |event| %>
          <tr>
            <td><%= event.created_at.to_date%></td>
            <td>Visita</td>
            <td><%= event.diagnose %></td>
            <td><%= event.treatment %></td>

            <td>
              <a href="/events/<%= event.id %>" class="btn btn-primary">Ver</a>
              <a href="/events/<%= event.id %>/edit" class="btn btn-warning; background-color:blue">Editar</a>
              <a href="/delete_event/<%= event.id %>" class="btn btn-danger" rel="nofollow"><i class="fa fa-trash-o" aria-hidden="true"></i>
</a>
            </td>
            <td>
              <% ary = Array.new %>
              <% @claims.where("event_id"=> event.id).each do |claim|%>
              <% ary.push(claim.id) %>
              <% end %>
              <% if ary.empty? %>

              <!-- Boton Crear Reclamo  -->
              <form action="/create_claim" method="post">
                <!-- Hidden input for authenticity token to protect from forgery -->
                <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">

                <input type="hidden" id="doctor_id" name="doctor_id" placeholder="Doctor" class="form-control" value="<%= current_doctor.id %>">
                <input type="hidden" id="patient_id" name="patient_id" placeholder="Patient" class="form-control" value="<%= @medical_relation.patient_id %>">
                <input type="hidden" id="doctor_name" name="doctor_name" placeholder="Doctor name" class="form-control" value="<%= @medical_relation.doctor.practice_name %>">
                <input type="hidden" id="age" name="age" placeholder="Age" class="form-control" value="<%= @age %>">
                <input type="hidden" id="patient_name" name="patient_name" placeholder="" class="form-control" value="<%= @medical_relation.patient.first_name %> <%= @medical_relation.patient.last_father %> <%= @medical_relation.patient.last_mother %>">
                <input type="hidden" id="gender" name="gender" placeholder="" class="form-control" value="<%= @medical_relation.patient.gender.capitalize %>">
                <input type="hidden" id="event_id" name="event_id" placeholder="Event" class="form-control" value="<%= event.id %>">

                <button class="btn btn-success">
                  Generar Reporte
                </button>
              </form>
              <% else %>
              <a href="/claims/<%= ary.first %>" class="btn btn-primary">Ver Reporte</a>
              <% end %>
            </td>

          </td>
        </tr>
        <% end %>
      </table>
    </div>
  </div>


  <div class="btn-group btn-group-justified">
    <a href="/medical_relations" class="btn btn-primary">
      Back
    </a>
    <!-- <a href="/medical_relations/<%= @medical_relation.id %>/edit" class="btn btn-warning">
    Edit
  </a> -->
  <a href="/delete_medical_relation/<%= @medical_relation.id %>" class="btn btn-danger" rel="nofollow">
    Delete
  </a>
</div>
</div>
</div>
