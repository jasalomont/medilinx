<div class="page-header">
  <h1>
    Lista de Reclamos
    <!-- <a href="/claims/new" class="btn btn-md btn-success">Generar nuevo</a> -->
  </h1>
</div>


<form action="/create_claim" method="post">
  <!-- Hidden input for authenticity token to protect from forgery -->
  <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">
  <input type="hidden" id="patient_id" name="patient_id" placeholder="" class="form-control" value="<%= current_patient.id %>">
  <input type="hidden" id="patient_name" name="patient_name" placeholder="" class="form-control" value="<%= current_patient.first_name %> <%= current_patient.last_father%> <%= current_patient.last_mother%>">



  <div class="row">
    <div class="col-md-12">
      <div class="panel panel-default" style="background-color:#E7E7E7" >
        <div class="panel-body">
          <div class="col-md-3">
            <button class="btn btn-success">
              Solicitar Informe Médico
            </button>
          </div>
          <div class="col-md-3">

            <%= select_tag(:doctor_id, options_from_collection_for_select(Doctor.all, :id, :practice_name, @claim.doctor_id), :class => "form-control") %>
          </div>
          <div class="col-md-3">
            <input list="tipo_reclamo" id="claim_type" name="claim_type" placeholder="Tipo de Informe*" class="form-control" value="<%= @claim.claim_type %>">
            <datalist class="" id="tipo_reclamo">
              <option value="Programación de cirugía"></option>
              <option value="Tratamiento médico"></option>
              <option value="Reembolso"></option>
            </datalist>
          </div>
          <div class="col-md-3">
            <input list="nombre_aseguradora" id="insurance_name" name="insurance_name" placeholder="Nombre de Aseguradora*" class="form-control" value="<%= @claim.insurance_name %>">
            <datalist class="" id="nombre_aseguradora">
              <option value="Allianz"></option>
              <option value="AXA"></option>

            </datalist>
          </div>
          <div class="col-md-offset-3 col-md-9">

            <input type="hidden" id="patient_request" name="patient_request" value="1" <%= "checked" %>>
            <!-- <span style="color:red">Acepto las condiciones de enviar la solicitud de reclamo</span> -->
          </div>
        </div>
      </div>
    </div>
  </div>
</form>


<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">


    <table class="table table-striped table-hover">
      <tr>

        <th>Doctor</th>
        <th>Aseguradora</th>
        <th>Tipo</th>
        <th>Causa</th>
        <th>Fecha de creación</th>
        <th>Última actualización</th>
        <th style="text-align: center">Status</th>
        <th></th>
      </tr>

      <% @claims.reverse.each do |claim| %>
      <tr>
        <td><%= Doctor.find(claim.doctor_id).practice_name %></td>
        <td><%= claim.insurance_name %></td>
        <td><%= claim.claim_type %></td>
        <td><%= claim.attention_cause %></td>
        <td><%= claim.created_at.to_date %></td>
        <td><%= claim.updated_at.to_date %></td>

        <% if @claim_follows.where("claim_id"=>claim.id).exists? == true %>


        <% if claim.claim_follow.insurance_approved != nil %>

        <!-- #Aporbado/No Aprobado -->
        <% if claim.claim_follow.insurance_approved == true %>
        <td  style="text-align: center"><span style="color:green"><i class="fa fa-check-circle-o fa-lg" aria-hidden="true"></i></span></td>
        <% else %>
        <td  style="text-align: center"><span style="color:red"><i class="fa fa-times-circle-o fa-lg" aria-hidden="true"></i></i></span></td>
        <% end %>
        <td style="text-align: left"><a href="/claims/<%= claim.id %>" class="btn btn-sm btn-primary" style="width:65px">Abrir</a></td>

        <!-- #Proceseo iniciado -->
        <% elsif claim.claim_follow.insurance_read == true %>
        <td  style="text-align: center"><span style="color:blue"> <i class="fa fa-envelope-open-o fa-lg" aria-hidden="true"></i> </span></td>
        <td style="text-align: left"><a href="/claims/<%= claim.id %>" class="btn btn-sm btn-primary" style="width:65px">Abrir</a></td>

<% else %>
        <td  style="text-align: center"><span style="color:red"> <i class="fa fa-envelope-o fa-lg" aria-hidden="true"></i> <%= claim.insurance_name %></span></td>
        <td style="text-align: left"><a href="/claims/<%= claim.id %>" class="btn btn-sm btn-primary" style="width:65px">Abrir</a></td>
        <% end %>

        <% else %>

        <% if claim.patient_request == true %>
        <td  style="text-align: center"><span style="color:red">  <i class="fa fa-bell-o fa-lg" aria-hidden="true"></i> </span></td>
        <td><a href="/delete_claim/<%= claim.id %>" class="btn btn-sm btn-danger" rel="nofollow" style="width:65px"><i class="fa fa-trash-o" aria-hidden="true"></i</a>

        </td>
        <% elsif claim.doctor_start == true%>
        <!-- En proceso Dr. -->
        <td style="color:blue; text-align: center"><i class="fa fa-clock-o fa-lg" aria-hidden="true"></i> </td>
        <td style="text-align: left"><a href="/claims/<%= claim.id %>" class="btn btn-sm btn-primary" style="width:65px">Abrir</a></td>

        <% elsif claim.doctor_sign == true %>
        <td style="color:green; text-align: center">Firmado</td>
        <td style="text-align: left"><a href="/claims/<%= claim.id %>" class="btn btn-sm btn-primary" style="width:65px">Abrir</a></td>

        <% else %>
        <td style="color:blue; text-align: center"><i class="fa fa-clock-o fa-lg" aria-hidden="true"></i></td>
        <td style="text-align: left"><a href="/claims/<%= claim.id %>" class="btn btn-sm btn-primary" style="width:65px">Abrir</a></td>

        <% end %>
        <% end %>
      </tr>
      <% end %>
    </table>
  </div>
  </div>
</div>
